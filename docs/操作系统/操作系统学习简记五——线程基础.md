# 操作系统学习简记五——线程基础

## 目标

需要一组实体，满足：

* 
比进程更加轻量级；
* 
实体之间可以并发执行；
* 实体之间共享相同的地址空间。

## 定义

进程中的一条执行流程。

## 表示

线程控制块（TCB）

包含的信息：主要是状态记录信息，如PC、SP、状态等等，但这些资源本身是属于进程的。

## 进程与线程

二者比较

* 进程是资源分配单位，线程是CPU调度单位；
* 进程拥有完整资源平台，线程只独享部分资源；
* 二者都有就绪、阻塞、执行三种状态，同样具有状态间的转换；
* 线程能减少并发执行的时间和空间开销

  * 创建、终止时间短；
  * 切换快；
  * 统一进程内共享资源，通讯不用通过内核。

## 实现

一般有三种实现方式，不同的操作系统选择的实现方式可能不同：

* 用户线程：在用户空间实现，由应用程序管理。如POSIX Pthreads、Solaris threads；
* 内核线程：在内核中实现，由内核管理。如Windows、Linux；
* 轻量级线程：在内核中实现，支持用户线程？？。

### 用户线程

由某些库支持，被应用进程调用、管理，操作系统看不见这些线程（也即看不到TCB），操作系统只能看到进程。

用户空间实现的用户线程，不依赖于操作系统的内核，有一组**用户级**的线程库函数来管理。

#### 特点

* 不需要操作系统了解用户线程的存在，可以用于本身不支持线程技术的操作系统；
* 用户线程的切换也是由线程库函数来完成，由于不依赖内核，所以不涉及用户态和内核态的切换，速度很快；
* 允许每个进程拥有自定义的线程调度算法；

#### 缺点

* 如果线程发起了一个阻塞型的系统调用，会导致整个进程陷入阻塞，包括其他线程。这是因为操作系统只能感知到进程执行了阻塞操作；
* 
当一个线程开始执行后，除非它主动交出CPU使用权，否则它所在的进程中的其它线程无法执行。这也是因为操作系统感知不到线程的存在，所以它无法对同一个进程内的线程进行调度。
* 
由于时间片是分配给进程的，进程才是资源平台，所以多线程情况下的进程，内核感知不到，分配的时间片可能不合理。

### 内核线程

线程通过内核管理，即TCB处于内核中。Window就是这么实现的。

### 轻量级进程

由内核支持的用户进程。

一个进程拥有多个轻量级进程，每个轻量级进程由一个的内核线程来支持（有可能多个轻量级进程由同一个内核线程支持）。

Solaris和Linux就是这么实现的。
