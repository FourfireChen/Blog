# 操作系统学习简记四——进程基础

## 基本概念

### 进程的组成

包含了正在运行的一个程序的所有状态信息

* 程序指令；
* 数据；
* 
程序计数器，指示下一条指令；
* 
通用寄存器、堆栈；
* 系统资源（如打开的文件）；

### 进程的特点

* 
动态性；
* 
并发性；

注：并发与并行不同。时间粒度不同。并发是指一段时间内有多个进程同时运行；并行是指在一个时刻有多个进程运行，是需要多核才能实现的。
* 
独立性：通过页表做管理，使得不同进程之间互补影响；
* 
制约性：访问共享资源或同步而产生的互相制约的关系。

### 进程的描述

进程控制块（Process Control Block, PCB）

操作系统为每个进程维护了一个PCB，描述了该进程的所有状态信息，PCB是进程存在的唯一标志。

* 进程的创建：生成一个PCB；
* 进程的中止：回收PCB；
* 进程的组织管理：组织管理PCB。

#### PCB包含的信息

* 进程标识信息。本进程标识、父进程标识、用户标识；
* 处理机状态，保存进程的运行现场信息。

  * 用户可用寄存器；
  * 控制和状态寄存器，如程序计数器、程序状态字；
  * 栈指针。
* 进程控制信息，描述进程当前的执行特征。

  * 调度和状态信息，描述进程当前运行状态；
  * 进程间通讯信息，记录进程间通信相关的信息，如各种标识、信号等，这些信息存在于**接收方**的PCB中；
  * 存储管理信息，包含指向本进程映像内存空间的数据结构；
  * 进程使用资源，由进程使用、打开的资源，如文件；
  * 有关数据结构链接信息，使得进程可以加入到一些数据结构，如某些队列中。（Node成员变量） 。

#### PCB的组织方式

有不同的方式：

* 链表：**同一状态的进程其PCB连成一个链表，多个状态对应多个不同链表**。也即各状态进程形成不同的链表，如就绪链表、阻塞链表。
* 索引表：**统一状态的进程归入一个index表**，其实就是数组。。。

## 进程的状态

### 生命周期

创建->运行->等待->唤醒->结束

#### 创建

引起创建有3个主要事件：

* 系统初始化时（init）；
* 用户请求创建一个新进程；
* 正在运行的进程执行了创建进程的系统调用。

#### 运行

内核选择一个就绪的进程，也即选择一个可以执行的进程，让它占用CPU而执行。（如何选择？）

#### 等待（阻塞）

3个主要情况：

* 请求并等待系统服务，无法马上完成；
* 启动某种操作，无法马上完成；
* 需要的数据没有到达；

等待是进程对自己的阻塞，进程只能自己阻塞自己。

#### 唤醒

3个主要情况：

* 等待进程需要的资源可被满足；
* 等待进程等待的事件到达；
* 将该进程的PCB插入到就绪队列。

进程只能被别的进程或操作系统唤醒。

唤醒后的进程实际上进入就绪状态而不是运行状态。

#### 结束

4种主要情况：

* 正常退出，自愿；
* 错误退出，自愿；
* 致命错误，强制；
* 被其他进程或操作系统杀死，强制。

### 进程状态变化模型

* 
  进程的三种基本状态：

  * 运行（Running）；
  * 就绪（Ready）：该进程获得了除处理机外的一切所需资源，也即满足执行的所有条件；
  * 等待（阻塞，Blocked）。
* 
  其它状态：

  * 创建；
  * 结束：正在结束。

### 进程挂起（Suspend）

定义：进程没有占用内存空间，与进程阻塞不同。可能情况如，在虚拟内存管理中，该进程占用的所有内存空间的内容被暂时换出到硬盘中。

#### 状态

挂起有两种：

* 阻塞挂起：进程在外存等待某种事件的发生；
* 就绪挂起：进程在外存，但只要进入内存，就可以执行。

#### 状态转换

* 
  挂起：内存->外存

  * 阻塞->阻塞挂起；
  * 就绪->就绪挂起；
  * 运行->就绪挂起：对抢先式分时系统，当有高优先级事件执行，且内存空间不足时，系统可能把运行状态转到就绪挂起状态。
* 
  外存中的状态转换：

  * 阻塞挂起->就绪挂起：当阻塞挂起需要的条件得到满足时，系统会把阻塞挂起状态转换成就绪挂起状态。
* 解挂/激活：外存->内存

  * 就绪挂起->就绪：当没有就绪进程，或者，该进程的优先级高于就绪进程时，会进行这种转换；
  * 阻塞挂起->阻塞：当内存足够时，会做这种转换。

## 进程的管理

### 状态队列

* OS维护各种队列，以描述系统当前各种状态下的进程；
* 不同状态的PCB在不同的队列中；
* 
当进程状态发生改变时，PCB在队列之间移动；
* 
同个状态可能有多个队列，如根据优先级不同分多个就绪队列。
